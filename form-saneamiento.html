<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Formulario Agua - EIEL</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
input, button, select { margin: 8px 0; padding: 6px; width: 100%; max-width: 400px; }
h2, h3 { margin-top: 20px; }
ul { padding-left: 18px; }
button { cursor: pointer; }
</style>
</head>
<body>

<h2>Formulario EIEL - Agua</h2>

<p><b>Municipio:</b> <span id="municipio"></span></p>

<label>PoblaciÃ³n abastecida</label>
<input type="number" id="poblacion" placeholder="Ej: 1200">

<label>Longitud de red (km)</label>
<input type="number" id="longitud" placeholder="Ej: 42.5">

<label>DepÃ³sitos principales (mÂ³)</label>
<input type="number" id="depositos" placeholder="Ej: 2500">

<h3>Adjuntar archivos</h3>

<input type="file" id="fileInput" multiple>
<button type="button" onclick="guardarArchivo()">ðŸ“Ž Guardar archivo(s)</button>

<ul id="fileList"></ul>

<br>
<button onclick="guardarDatos()">ðŸ’¾ Guardar datos</button>
<button onclick="finalizar()">âœ… Finalizar y firmar</button>

<script>
// VerificaciÃ³n de login
if (!localStorage.getItem('municipio')) {
  window.location.href = "login.html";
}

// Mostrar nombre del municipio
document.getElementById("municipio").textContent = localStorage.getItem('municipio');

// Cargar datos almacenados si existen
window.onload = function() {
  document.getElementById("poblacion").value = localStorage.getItem("agua_poblacion") || "";
  document.getElementById("longitud").value = localStorage.getItem("agua_longitud") || "";
  document.getElementById("depositos").value = localStorage.getItem("agua_depositos") || "";

  let stored = JSON.parse(localStorage.getItem('adjuntos_agua') || "[]");
  let list = document.getElementById('fileList');
  list.innerHTML = "";
  stored.forEach(name => {
    let li = document.createElement('li');
    li.textContent = name;
    list.appendChild(li);
  });
};

// Guardar campos
function guardarDatos() {
  localStorage.setItem("agua_poblacion", document.getElementById("poblacion").value);
  localStorage.setItem("agua_longitud", document.getElementById("longitud").value);
  localStorage.setItem("agua_depositos", document.getElementById("depositos").value);

  alert("âœ… Datos guardados localmente.");
}

// Guardar archivos (solo nombre)
function guardarArchivo() {
  const input = document.getElementById('fileInput');
  const files = input.files;

  if (!files.length) {
    alert("âš ï¸ No seleccionaste archivos");
    return;
  }

  let stored = JSON.parse(localStorage.getItem('adjuntos_agua') || "[]");

  for (let file of files) {
    stored.push(file.name);
  }

  localStorage.setItem('adjuntos_agua', JSON.stringify(stored));

  let list = document.getElementById('fileList');
  list.innerHTML = "";
  stored.forEach(name => {
    let li = document.createElement('li');
    li.textContent = name;
    list.appendChild(li);
  });

  alert("ðŸ“Ž Archivos registrados localmente");
}

// Finalizar (simulado)
function finalizar() {
  alert("âœ… Formulario finalizado.\n\n*En la versiÃ³n final, aquÃ­ se enviarÃ¡n los datos y se firmarÃ¡ electrÃ³nicamente.*");
}
</script>

</body>
</html>
